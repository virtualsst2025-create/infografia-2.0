<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Folletos de Seguridad Profesional (IA)</title>
    <!-- Scripts para exportar a Word -->
    <script src="[https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js](https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js)"></script>
    <script src="[https://unpkg.com/html-docx-js/dist/html-docx.js](https://unpkg.com/html-docx-js/dist/html-docx.js)"></script>
    <style>
        @import url('[https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Lato:wght@300;400;700&display=swap](https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Lato:wght@300;400;700&display=swap)');

        :root {
            --font-heading: 'Poppins', sans-serif;
            --font-body: 'Lato', sans-serif;
            --color-primary: #4a90e2;
            --color-secondary: #50e3c2;
            --color-dark: #2c3e50;
            --color-light: #ffffff;
            --color-gray: #7f8c8d;
            --color-bg-light: #f4f7f6;
            --shadow-soft: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-medium: 0 10px 25px rgba(0,0,0,0.1);
            --border-radius: 12px;
        }

        body {
            box-sizing: border-box;
            font-family: var(--font-body);
            margin: 0;
            padding: 0;
            background-color: var(--color-bg-light);
            color: var(--color-dark);
            min-height: 100vh;
            line-height: 1.7;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 50px;
            padding: 60px 20px;
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            color: var(--color-light);
            border-radius: 0 0 50% 50% / 0 0 10% 10%;
        }

        .header h1 {
            font-family: var(--font-heading);
            font-size: 3.2rem;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            font-weight: 700;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.95;
            max-width: 700px;
            margin: 0 auto;
            font-weight: 300;
        }

        .generator-section {
            background: var(--color-light);
            border-radius: var(--border-radius);
            padding: 40px;
            margin: -80px auto 40px auto;
            max-width: 1000px;
            box-shadow: var(--shadow-medium);
            position: relative;
            z-index: 10;
        }

        .generator-section h2 {
            font-family: var(--font-heading);
            font-size: 2rem;
            color: var(--color-dark);
            margin-bottom: 30px;
            text-align: center;
            font-weight: 600;
        }

        .input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .input-field label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            color: var(--color-dark);
            font-size: 0.9rem;
            font-family: var(--font-heading);
        }

        .input-field input, .input-field select {
            width: 100%;
            padding: 14px 18px;
            border: 1px solid #dfe6e9;
            border-radius: 8px;
            font-size: 1rem;
            font-family: var(--font-body);
            transition: all 0.3s ease;
            background: #fdfdfd;
        }

        .input-field input:focus, .input-field select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
        }

        .generate-btn {
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            color: var(--color-light);
            border: none;
            padding: 16px 35px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            font-family: var(--font-heading);
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .generate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(74, 144, 226, 0.3);
        }

        .brochure-container {
            display: none;
            background: var(--color-light);
            margin-bottom: 40px;
            animation: fadeIn 0.8s ease-out;
            box-shadow: var(--shadow-medium);
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* Estilo general del tr√≠ptico */
        .brochure-front, .brochure-back {
            width: 100%;
            height: 297mm;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            background: var(--color-light);
        }

        .brochure-front { page-break-after: always; }

        .panel {
            padding: 25px;
            border-right: 1px dashed #ced6e0;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        .panel:last-child { border-right: none; }

        /* Panel de Cubierta (Beneficios en el nuevo esquema) */
        .benefits-panel {
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            color: var(--color-light);
            text-align: center;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            transition: background 0.5s ease;
        }
        .benefits-panel::before {
            content: '';
            position: absolute;
            top: -50%; left: -50%;
            width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            animation: move-dots 40s linear infinite;
        }
        @keyframes move-dots {
            0% { transform: translate(0, 0); }
            100% { transform: translate(40px, 40px); }
        }
        /* Fin de estilos de cubierta */


        .panel-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--color-primary);
            transition: border-color 0.5s ease;
        }
        .panel-icon {
            width: 45px; height: 45px;
            margin-right: 15px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            color: var(--color-light);
            flex-shrink: 0;
            box-shadow: var(--shadow-soft);
        }
        .panel-title {
            font-family: var(--font-heading);
            font-size: 1.3rem;
            color: var(--color-dark);
            margin: 0;
            font-weight: 600;
        }
        .panel-description {
            font-size: 0.85rem;
            color: var(--color-gray);
            margin-bottom: 20px;
            font-style: italic;
        }
        .panel-list { list-style: none; padding: 0; margin: 0; flex: 1; }
        .panel-list li {
            padding: 10px 0;
            border-bottom: 1px solid #ecf0f1;
            display: flex;
            align-items: flex-start;
            font-size: 0.8rem;
            line-height: 1.5;
        }
        .panel-list li:last-child { border-bottom: none; }
        .panel-list li::before {
            content: "‚Ä¢";
            color: var(--color-primary);
            font-weight: bold;
            margin-right: 12px;
            margin-top: 2px;
            flex-shrink: 0;
            font-size: 1.2rem;
            transition: color 0.5s ease;
        }

        .panel-image { 
            width: 100%; 
            height: auto; 
            min-height: 80px; /* Asegurar espacio para el SVG */
            border-radius: 8px; 
            margin: 15px 0; 
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .panel-image svg { width: 80px; height: 80px; }
        
        /* ESTILOS ESPEC√çFICOS DE LOS NUEVOS PANELES */

        /* 1. Conceptos Fundamentales */
        .concept-panel .panel-icon { background: linear-gradient(135deg, #3498db, #2980b9); }
        .concept-panel .panel-header { border-color: #3498db; }
        .concept-panel .panel-list li::before { content: "üí°"; color: #3498db; font-size: 0.8rem; }
        
        /* 2. Caracter√≠sticas Clave */
        .characteristics-panel .panel-icon { background: linear-gradient(135deg, #9b59b6, #8e44ad); }
        .characteristics-panel .panel-header { border-color: #9b59b6; }
        .characteristics-panel .panel-list li::before { content: "‚≠ê"; color: #9b59b6; font-size: 0.8rem; }

        /* 3. Beneficios (Estilo de Cubierta) */
        .benefits-panel .panel-header { border: none; }
        .benefits-panel .panel-title { color: var(--color-light); }
        .benefits-panel .panel-icon { background: rgba(255,255,255,0.2); }
        .cover-title {
            font-family: var(--font-heading);
            font-size: 2.1rem;
            margin-bottom: 20px;
            position: relative;
            z-index: 2;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
            line-height: 1.3;
        }
        .cover-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            position: relative;
            z-index: 2;
            line-height: 1.5;
            margin-bottom: 30px;
        }
        .cover-image {
            width: 130px;
            height: 130px;
            margin: 20px auto;
            position: relative; z-index: 2;
        }

        /* 4. Medidas de Prevenci√≥n */
        .prevention-panel .panel-icon { background: linear-gradient(135deg, #2ecc71, #27ae60); }
        .prevention-panel .panel-header { border-color: #2ecc71; }
        .prevention-panel .panel-list li::before { content: "üõ°Ô∏è"; color: #2ecc71; }
        
        /* 5. Datos de Inter√©s */
        .data-panel .panel-icon { background: linear-gradient(135deg, #f1c40f, #f39c12); }
        .data-panel .panel-header { border-color: #f1c40f; }
        .data-panel .panel-list li::before { content: "üìä"; color: #f1c40f; font-size: 0.8rem; }

        /* 6. Ejemplos Pr√°cticos */
        .examples-panel .panel-icon { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .examples-panel .panel-header { border-color: #e74c3c; }
        .examples-panel .panel-list li::before { content: "üî®"; color: #e74c3c; font-size: 0.8rem; }


        .contact-info-footer {
             padding: 25px;
            border-top: 1px dashed #ced6e0;
            background: var(--color-bg-light);
            text-align: center;
        }
        .contact-info-footer h3 { font-family: var(--font-heading); color: var(--color-dark); margin-bottom: 15px; font-size: 1.2rem; }
        .contact-info-details { background: var(--color-light); padding: 15px; border-radius: 8px; margin-bottom: 15px; box-shadow: var(--shadow-soft); font-size: 0.85rem; display: inline-block; }
        .contact-info-details h4 { margin: 0 0 10px 0; }
        .contact-info-details p { margin: 5px 0; color: var(--color-gray); }
        .emergency-numbers { background: #fee; border: 2px solid #e74c3c; padding: 15px; border-radius: 8px; display: inline-block; margin-left: 20px; }
        .emergency-numbers h4 { color: #e74c3c; margin: 0 0 10px 0; font-size: 1rem; }
        .emergency-numbers p { margin: 5px 0; font-weight: 700; color: var(--color-dark); }
        
        .download-section { text-align: center; padding: 30px; background: var(--color-bg-light); border-top: 1px solid #dfe6e9; }
        .download-btn {
            background: var(--color-primary);
            color: var(--color-light);
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            font-family: var(--font-body);
            cursor: pointer;
            margin: 5px 10px;
            transition: all 0.3s ease;
        }
        .download-btn:hover { background: var(--color-dark); transform: translateY(-2px); }

        .loading { text-align: center; padding: 80px 40px; color: var(--color-gray); }
        .spinner {
            border: 4px solid #ecf0f1;
            border-top: 4px solid var(--color-primary);
            border-radius: 50%;
            width: 50px; height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 30px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .template-preview {
            display: block;
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dfe6e9;
        }
        .template-preview h3 {
            margin: 0 0 15px 0;
            font-family: var(--font-heading);
            font-size: 1rem;
            text-align: center;
            color: var(--color-dark);
            font-weight: 600;
        }
        .preview-palette {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .palette-color {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: var(--bg, #ccc);
            box-shadow: var(--shadow-soft);
            transition: transform 0.3s ease;
        }
        .palette-color:hover {
            transform: scale(1.1);
        }

        /* Estilos de plantillas */
        /* TEMPLATE: corporate */
        .template-corporate {
            --color-primary: #1e3a8a; /* Azul oscuro corporativo */
            --color-secondary: #fcd34d; /* Amarillo acento */
            --color-dark: #1f2937;
        }
        .template-corporate .prevention-panel .panel-icon { background: linear-gradient(135deg, #10b981, #059669); }
        .template-corporate .data-panel .panel-icon { background: linear-gradient(135deg, #fcd34d, #d97706); }
        .template-corporate .examples-panel .panel-icon { background: linear-gradient(135deg, #b91c1c, #991b1b); }
        .template-corporate .panel-header { border-color: var(--color-primary); }
        
        /* TEMPLATE: creative */
        .template-creative {
            --font-heading: 'Poppins', cursive; 
            --color-primary: #f472b6; /* Rosa */
            --color-secondary: #8b5cf6; /* Morado */
            --color-dark: #374151;
            --color-bg-light: #fff7ed;
        }
        .template-creative .benefits-panel { background: linear-gradient(145deg, var(--color-primary), var(--color-secondary)); }
        .template-creative .panel-icon { border-radius: 50%; }
        .template-creative .panel-list li::before { content: "‚ú®"; color: var(--color-secondary); font-size: 0.9rem; }
        .template-creative .examples-panel .panel-list li::before { content: "üõë"; color: #ef4444; }


        
        @media (max-width: 768px) {
            .header h1 { font-size: 2.2rem; }
            .header { padding: 40px 20px; }
            .generator-section { margin-top: -60px; padding: 30px; }
            .input-group { grid-template-columns: 1fr; }
            .contact-info-footer { display: block; }
            .emergency-numbers { margin-left: 0; margin-top: 15px; display: block; }
        }

        @media print {
            body { background: var(--color-light); padding: 0; margin: 0; }
            .container { max-width: none; padding: 0; }
            /* Ocultar elementos de la interfaz de usuario */
            .header, .generator-section, .download-section, .loading, .template-preview { display: none !important; }
            
            /* Mostrar el folleto */
            .brochure-container { 
                display: block !important; 
                box-shadow: none; 
                margin: 0; 
                border-radius: 0;
                width: 210mm; /* Ancho de A4 */
                height: 297mm; /* Alto de A4 */
                overflow: visible;
                position: relative;
            }
            .brochure-content-wrapper { 
                width: 210mm; 
                height: 297mm;
            }
            
            /* Asegurar el dise√±o del tr√≠ptico */
            .brochure-front, .brochure-back { 
                width: 100%; 
                height: 297mm; 
                display: grid; 
                grid-template-columns: 1fr 1fr 1fr;
            }
            .brochure-front { page-break-after: always; }
            .brochure-back { page-break-after: auto; }

            /* Estilos de panel para impresi√≥n */
            .panel { 
                padding: 10mm; 
                border-right: 1px solid #ccc; 
                font-size: 9pt; 
                line-height: 1.4; 
                box-sizing: border-box;
                height: 100%;
            }
            .panel:last-child { border-right: none; }
            
            /* Ajustes de tama√±o de texto */
            .cover-title { font-size: 18pt; }
            .cover-subtitle { font-size: 10pt; }
            .panel-title { font-size: 14pt; }
            .panel-description { font-size: 8pt; }
            .panel-list li { font-size: 8pt; padding: 3px 0; }
            .panel-image { height: 60px; margin: 10px 0; }
            .cover-image { width: 80px; height: 80px; }
            
            /* Forzar la impresi√≥n de colores y fondos */
            * { -webkit-print-color-adjust: exact !important; color-adjust: exact !important; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Generador de Folletos de Seguridad (Impulsado por IA)</h1>
            <p>Genera folletos profesionales en espa√±ol sobre cualquier tema de seguridad industrial, con contenido adaptado y estructura de tr√≠ptico.</p>
        </header>

        <main>
            <section class="generator-section">
                <h2>Dise√±a tu Folleto Profesional</h2>
                <form id="brochureForm">
                    <div class="input-group">
                        <div class="input-field">
                            <label for="topic">Tema Principal del Folleto</label>
                            <input type="text" id="topic" name="topic" placeholder="Ej: Seguridad en montacargas, Bioseguridad en salud..." required>
                        </div>
                        <div class="input-field">
                            <label for="industry">Sector Industrial</label>
                            <select id="industry" name="industry">
                                <option value="general">General</option>
                                <option value="construccion">Construcci√≥n</option>
                                <option value="manufactura">Manufactura</option>
                                <option value="oficina">Oficina / Servicios</option>
                                <option value="salud">Salud</option>
                            </select>
                        </div>
                         <div class="input-field">
                            <label for="template">Estilo de Dise√±o</label>
                            <select id="template" name="template">
                                <option value="modern">Moderno y Limpio</option>
                                <option value="corporate">Corporativo</option>
                                <option value="creative">Creativo</option>
                            </select>
                        </div>
                    </div>

                    <div class="template-preview">
                        <h3>Paleta de Colores del Estilo</h3>
                        <div class="preview-palette" id="previewPalette">
                            <!-- Los colores se llenar√°n con JS -->
                        </div>
                    </div>
                    
                    <button type="submit" class="generate-btn" id="generateBtn">
                        <svg xmlns="[http://www.w3.org/2000/svg](http://www.w3.org/2000/svg)" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path><path d="M5 3v4"></path><path d="M19 17v4"></path><path d="M3 5h4"></path><path d="M17 19h4"></path></svg>
                        Generar Contenido con Gemini
                    </button>
                </form>
            </section>

            <div id="loadingSection" class="brochure-container">
                <div class="loading">
                    <div class="spinner"></div>
                    <h3>Generando tu folleto...</h3>
                    <p>Estamos solicitando a Gemini que redacte el contenido profesional. Esto puede tardar unos segundos.</p>
                </div>
            </div>

            <div id="brochureResult" class="brochure-container">
                <div class="brochure-content-wrapper">
                    <!-- CARA FRONTAL DEL TR√çPTICO (Orden de Plegado: Conceptos, Caracter√≠sticas, Beneficios/Cubierta) -->
                    <div class="brochure-front">
                        <div class="panel content-panel concept-panel">
                            <div class="panel-header">
                                <div class="panel-icon">üí°</div>
                                <h2 class="panel-title">Conceptos Fundamentales</h2>
                            </div>
                            <p class="panel-description" id="conceptDescription"></p>
                            <div class="panel-image" id="conceptImage"></div>
                            <ul class="panel-list" id="conceptList"></ul>
                        </div>
                        <div class="panel content-panel characteristics-panel">
                            <div class="panel-header">
                                <div class="panel-icon">‚öôÔ∏è</div>
                                <h2 class="panel-title">Caracter√≠sticas Clave</h2>
                            </div>
                            <p class="panel-description" id="characteristicsDescription"></p>
                            <div class="panel-image" id="characteristicsImage"></div>
                            <ul class="panel-list" id="characteristicsList"></ul>
                        </div>
                        <div class="panel content-panel benefits-panel">
                            <!-- ESTE PANEL ACT√öA COMO LA CUBIERTA PRINCIPAL -->
                            <div>
                                <h1 class="cover-title" id="mainTitle"></h1>
                                <p class="cover-subtitle" id="mainSubtitle"></p>
                                <div class="cover-image" id="coverImage"></div>
                            </div>
                            <h2 class="panel-title" style="margin-top: 30px;" id="benefitsTitle">Beneficios de la Prevenci√≥n</h2>
                            <p class="panel-description" style="color: rgba(255,255,255,0.8);" id="benefitsDescription"></p>
                            <ul class="panel-list" id="benefitsList" style="color: var(--color-light);"></ul>
                        </div>
                    </div>
                    <!-- CARA POSTERIOR DEL TR√çPTICO (Contenido Interior y Contraportada) -->
                    <div class="brochure-back">
                        <div class="panel content-panel prevention-panel">
                            <div class="panel-header">
                                <div class="panel-icon">üõ°Ô∏è</div>
                                <h2 class="panel-title">Medidas de Prevenci√≥n</h2>
                            </div>
                            <p class="panel-description" id="preventionDescription"></p>
                            <div class="panel-image" id="preventionImage"></div>
                            <ul class="panel-list" id="preventionList"></ul>
                        </div>
                        <div class="panel content-panel data-panel">
                            <div class="panel-header">
                                <div class="panel-icon">üìä</div>
                                <h2 class="panel-title">Datos de Inter√©s</h2>
                            </div>
                            <p class="panel-description" id="dataDescription"></p>
                            <div class="panel-image" id="dataImage"></div>
                            <ul class="panel-list" id="dataList"></ul>
                        </div>
                        <div class="panel content-panel examples-panel">
                            <div class="panel-header">
                                <div class="panel-icon">üî®</div>
                                <h2 class="panel-title">Ejemplos Pr√°cticos</h2>
                            </div>
                            <p class="panel-description" id="examplesDescription"></p>
                            <div class="panel-image" id="examplesImage"></div>
                            <ul class="panel-list" id="examplesList"></ul>
                        </div>
                    </div>
                </div>
                
                <div class="contact-info-footer">
                    <h3>Contacto y Emergencias (Contraportada)</h3>
                    <div class="contact-info-details">
                        <h4>Departamento de Seguridad</h4>
                        <p>üìß seguridad@empresa.com</p>
                        <p>üì± Ext. 2345</p>
                    </div>
                    <div class="emergency-numbers">
                        <h4>üö® N√∫meros de Emergencia</h4>
                        <p>Bomberos: 911 / 112</p>
                        <p>Ambulancia: 911 / 112</p>
                    </div>
                </div>

                <div class="download-section">
                    <button class="download-btn" onclick="downloadAsPDF()">üìÑ Descargar como PDF</button>
                    <button class="download-btn" onclick="downloadAsWord()">üìÑ Descargar como Word</button>
                    <button class="download-btn" onclick="generateNew()">üìã Crear Nuevo Folleto</button>
                </div>
            </div>
        </main>
    </div>

    <script>
        const apiKey = ""; 
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        // Esquema JSON para asegurar que el modelo devuelva la estructura exacta de 6 secciones
        const contentSchema = {
            type: "OBJECT",
            properties: {
                title: { 
                    type: "STRING", 
                    description: "T√≠tulo principal y llamativo del folleto, enfocado en el tema, por ejemplo: 'Seguridad en Montacargas: Gu√≠a R√°pida'."
                },
                subtitle: { 
                    type: "STRING", 
                    description: "Subt√≠tulo descriptivo que incluye el sector industrial de forma profesional."
                },
                conceptos: {
                    type: "OBJECT",
                    properties: {
                        description: { type: "STRING", description: "P√°rrafo introductorio de los conceptos." },
                        list: { type: "ARRAY", items: { type: "STRING" }, description: "4 puntos fundamentales o definiciones clave." }
                    }
                },
                caracteristicas: {
                    type: "OBJECT",
                    properties: {
                        description: { type: "STRING", description: "P√°rrafo introductorio sobre las caracter√≠sticas o aspectos a observar." },
                        list: { type: "ARRAY", items: { type: "STRING" }, description: "4 se√±ales, aspectos o caracter√≠sticas clave." }
                    }
                },
                beneficios: {
                    type: "OBJECT",
                    properties: {
                        description: { type: "STRING", description: "P√°rrafo que resume los beneficios de la prevenci√≥n (ideal para la portada)." },
                        list: { type: "ARRAY", items: { type: "STRING" }, description: "4 beneficios claros y concisos." }
                    }
                },
                prevencion: {
                    type: "OBJECT",
                    properties: {
                        description: { type: "STRING", description: "P√°rrafo introductorio sobre las medidas de prevenci√≥n." },
                        list: { type: "ARRAY", items: { type: "STRING" }, description: "4 medidas de prevenci√≥n obligatorias o esenciales." }
                    }
                },
                datos_interes: {
                    type: "OBJECT",
                    properties: {
                        description: { type: "STRING", description: "P√°rrafo que introduce datos curiosos o estad√≠sticas." },
                        list: { type: "ARRAY", items: { type: "STRING" }, description: "4 datos, estad√≠sticas o normativas interesantes." }
                    }
                },
                ejemplos: {
                    type: "OBJECT",
                    properties: {
                        description: { type: "STRING", description: "P√°rrafo que introduce los ejemplos pr√°cticos o los pasos a seguir." },
                        list: { type: "ARRAY", items: { type: "STRING" }, description: "4 ejemplos pr√°cticos o pasos de respuesta inmediata." }
                    }
                }
            },
            propertyOrdering: ["title", "subtitle", "conceptos", "caracteristicas", "beneficios", "prevencion", "datos_interes", "ejemplos"],
            required: ["title", "subtitle", "conceptos", "caracteristicas", "beneficios", "prevencion", "datos_interes", "ejemplos"]
        };


        // --- L√≥gica del Generador ---
        document.getElementById('brochureForm').addEventListener('submit', function(e) {
            e.preventDefault();
            generateBrochure();
        });

        const templateSelector = document.getElementById('template');
        const brochureResult = document.getElementById('brochureResult');
        templateSelector.addEventListener('change', (e) => {
            // Eliminar clases de plantilla anteriores
            brochureResult.classList.remove('template-corporate', 'template-creative');
            document.body.classList.remove('template-corporate', 'template-creative');

            const templateName = e.target.value;
            if (templateName !== 'modern') {
                 brochureResult.classList.add(`template-${templateName}`);
                 document.body.classList.add(`template-${templateName}`);
            }
            updatePalettePreview(templateName);
        });

        function updatePalettePreview(templateName) {
            const palettes = {
                modern: { primary: '#4a90e2', secondary: '#50e3c2', dark: '#2c3e50', accent: '#7f8c8d' },
                corporate: { primary: '#1e3a8a', secondary: '#fcd34d', dark: '#1f2937', accent: '#95a5a6' },
                creative: { primary: '#f472b6', secondary: '#8b5cf6', dark: '#374151', accent: '#1abc9c' }
            };
            const paletteContainer = document.getElementById('previewPalette');
            paletteContainer.innerHTML = '';
            
            const selectedPalette = palettes[templateName];
            Object.values(selectedPalette).forEach(color => {
                const colorDiv = document.createElement('div');
                colorDiv.className = 'palette-color';
                colorDiv.style.setProperty('--bg', color);
                paletteContainer.appendChild(colorDiv);
            });
        }


        async function generateBrochure() {
            const topic = document.getElementById('topic').value.trim();
            const industry = document.getElementById('industry').value;
            const template = document.getElementById('template').value;
            
            if (!topic) {
                showNotification('Por favor ingresa un tema para el folleto', 'warning');
                return;
            }

            // Aplicar la clase de estilo antes de mostrar el resultado
            brochureResult.classList.remove('template-corporate', 'template-creative');
            document.body.classList.remove('template-corporate', 'template-creative');
            if (template !== 'modern') {
                 brochureResult.classList.add(`template-${template}`);
                 document.body.classList.add(`template-${template}`);
            }

            document.getElementById('loadingSection').style.display = 'block';
            document.getElementById('brochureResult').style.display = 'none';
            
            try {
                const generatedContent = await fetchAIContent(topic, industry);
                
                populateAdvancedBrochure(generatedContent, topic);
                
                document.getElementById('loadingSection').style.display = 'none';
                document.getElementById('brochureResult').style.display = 'block';
                document.getElementById('brochureResult').scrollIntoView({ behavior: 'smooth', block: 'start' });
                showNotification('¬°Folleto generado por IA exitosamente!', 'success');
            } catch (error) {
                console.error('Error al generar el folleto:', error);
                document.getElementById('loadingSection').style.display = 'none';
                showNotification(`Error de Contenido: ${error.message}`, 'error');
            }
        }
        
        // Funci√≥n para sanear el texto JSON (quitar delimitadores de markdown)
        function sanitizeJsonText(text) {
            if (typeof text !== 'string') return text;
            text = text.trim();
            // Quitar los delimitadores de markdown JSON si est√°n presentes
            if (text.startsWith('```json') && text.endsWith('```')) {
                text = text.substring(7, text.length - 3).trim();
            } else if (text.startsWith('```') && text.endsWith('```')) {
                text = text.substring(3, text.length - 3).trim();
            }
            return text;
        }

        async function fetchAIContent(topic, industry) {
            const topicUpper = topic.charAt(0).toUpperCase() + topic.slice(1);
            const systemPrompt = `Eres un experto en seguridad industrial y salud ocupacional. Tu tarea es generar contenido detallado para un folleto tr√≠ptico en espa√±ol sobre el tema de seguridad proporcionado. El contenido debe ser altamente profesional, riguroso y conciso. La salida DEBE ser un objeto JSON que siga el esquema exacto proporcionado, sin pre√°mbulos, explicaciones o texto adicional.`;
            
            const userQuery = `Genera el contenido para un folleto de seguridad.
                Tema principal: ${topicUpper}.
                Sector industrial enfocado: ${industry === 'general' ? 'Cualquier sector' : industry}.
                Aseg√∫rate de que la descripci√≥n para el panel 'beneficios' y el 'title' sean muy atractivos, ya que sirven como cubierta del folleto.
                Incluye 4 puntos para la lista de cada secci√≥n.`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: contentSchema
                }
            };

            let attempt = 0;
            const maxRetries = 5;
            
            while (attempt < maxRetries) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.status === 429) {
                         if (attempt < maxRetries - 1) {
                            const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                            console.warn(`Intento ${attempt + 1}: Tasa limitada (429). Reintentando en ${Math.round(delay / 1000)}s...`);
                            attempt++;
                            await new Promise(resolve => setTimeout(resolve, delay));
                            continue;
                        } else {
                            throw new Error("Tasa de solicitudes excedida. Por favor, int√©ntelo de nuevo m√°s tarde.");
                        }
                    }

                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error("Respuesta HTTP no exitosa:", response.status, errorText);
                        throw new Error(`Error de la API de Gemini: C√≥digo ${response.status}`);
                    }

                    const result = await response.json();
                    const jsonText = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    
                    if (!jsonText) {
                        throw new Error("No se pudo obtener el texto JSON de la respuesta del modelo (contenido vac√≠o).");
                    }
                    
                    // PASO CR√çTICO DE SANEO: Limpiar posibles delimitadores de markdown antes de parsear
                    const sanitizedText = sanitizeJsonText(jsonText);
                    const parsedJson = JSON.parse(sanitizedText);
                    
                    // Validaci√≥n b√°sica de la estructura
                    if (!parsedJson.conceptos || !parsedJson.title || !parsedJson.prevencion) {
                         throw new Error("La respuesta JSON del modelo est√° incompleta o mal formada despu√©s de la limpieza.");
                    }

                    return parsedJson;

                } catch (e) {
                    // Solo reintentamos si no es el √∫ltimo intento
                    if (attempt < maxRetries - 1 && !(e.message.includes("Tasa de solicitudes excedida"))) {
                        console.error(`Error en el intento ${attempt + 1}:`, e.message);
                        attempt++;
                        const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        continue;
                    } else {
                        // Si es el √∫ltimo intento y falla, lanzamos el error definitivo
                        throw new Error(`Fallo definitivo en la generaci√≥n de contenido. Detalle: ${e.message}`);
                    }
                }
            }
        }


        function getTopicKey(topic) {
            const topicLower = topic.toLowerCase();
            const categoryKeywords = {
                'alturas': ['altura', 'elevaci√≥n', 'andamio', 'escalera', 'techo', 'ca√≠da', 'cuerda'],
                'qu√≠micos': ['qu√≠mico', 'sustancia', 't√≥xico', 'corrosivo', 'laboratorio', 'solvente', 'msds', 'gds'],
                'ergonom√≠a': ['ergonom√≠a', 'postura', 'lumbar', 't√∫nel carpiano', 'oficina', 'repetitivo'],
                'incendios': ['incendio', 'fuego', 'llama', 'humo', 'extintor', 'evacuaci√≥n', 'alarma'],
                'montacargas': ['montacargas', 'forklift', 'apilador', 'almac√©n', 'carga', 'log√≠stica']
            };
            for (let category in categoryKeywords) {
                if (categoryKeywords[category].some(keyword => topicLower.includes(keyword))) {
                    return category;
                }
            }
            return 'generic';
        }

        function getTopicSpecificSVGs(topic) {
            const topicKey = getTopicKey(topic);
            
            // Iconograf√≠a basada en la l√≥gica de seguridad m√°s com√∫n
            const svgs = {
                alturas: {
                    conceptos: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><g transform="rotate(15 50 50)"><rect x="45" y="10" width="10" height="80" fill="#4a90e2" opacity="0.7"/><path d="M50 20 A 8 8 0 1 1 50 19.9" fill="#3498db"/><path d="M50 28 L50 55 L42 65 L58 65 Z" fill="#3498db"/><path d="M50 25 L75 5" stroke="#4a90e2" stroke-width="4" stroke-linecap="round"/></g></svg>`,
                    caracteristicas: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><polygon points="50,10 95,90 5,90" fill="#f1c40f"/><text x="50" y="70" font-size="40" text-anchor="middle" fill="white" font-weight="bold">!</text><path d="M20 80 C 30 60, 40 80, 50 60 S 70 80, 80 60" stroke="white" stroke-width="4" fill="none" stroke-linecap="round"/></svg>`,
                    beneficios: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M50 10 L90 35 L90 85 L50 110 L10 85 L10 35 Z" fill="rgba(255,255,255,0.8)"/><rect x="40" y="40" width="20" height="50" fill="#4a90e2"/><path d="M30 90 L70 90 L70 95 L30 95 Z" fill="#2c3e50"/></svg>`,
                    prevencion: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><g><path d="M50 15 A 8 8 0 1 1 50 14.9" fill="#2ecc71"/><path d="M50 23 L50 55 L42 65 L58 65 Z" fill="#2ecc71"/><path d="M50,23 Q20,30 20,50 T 50 90 T 80 50 Q80,30 50,23" stroke="#2ecc71" stroke-width="4" fill="none"/></g></svg>`,
                    datos_interes: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M50,10 A35,35 0 1,1 50,80 A10,10 0 0,1 50,60 A15,15 0 0,0 50,30 A35,35 0 0,1 50,10" fill="#f1c40f"/><circle cx="50" cy="90" r="5" fill="#f1c40f"/></svg>`,
                    ejemplos: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="40" fill="#e74c3c"/><rect x="45" y="25" width="10" height="50" fill="white"/><rect x="25" y="45" width="50" height="10" fill="white"/></svg>`
                },
                qu√≠micos: {
                    conceptos: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M50,10 C20,10 10,40 10,60 C10,90 50,90 50,90 C50,90 90,90 90,60 C90,40 80,10 50,10 Z" fill="#3498db"/><circle cx="35" cy="40" r="5" fill="white"/><circle cx="65" cy="40" r="5" fill="white"/><path d="M30 60 Q 50 75, 70 60" stroke="white" stroke-width="5" fill="none" stroke-linecap="round"/></svg>`,
                    caracteristicas: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M20,80 L50,20 L80,80 Z" stroke="#f1c40f" stroke-width="8" fill="none" stroke-linejoin="round" stroke-linecap="round"/><circle cx="50" cy="70" r="5" fill="#f1c40f"/></svg>`,
                    beneficios: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M20 90 L20 40 Q 20 20, 50 20 Q 80 20, 80 40 L80 90 Z" fill="rgba(255,255,255,0.8)"/><rect x="15" y="90" width="70" height="10" fill="rgba(255,255,255,0.8)"/><path d="M30 80 Q 50 60, 70 80" stroke="#4a90e2" stroke-width="4" fill="none"/><circle cx="35" cy="50" r="4" fill="#4a90e2"/><circle cx="50" cy="45" r="3" fill="#4a90e2"/><circle cx="65" cy="50" r="4" fill="#4a90e2"/></svg>`,
                    prevencion: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M20,50 a30,30 0 1,0 60,0 a30,30 0 1,0 -60,0" stroke="#2ecc71" stroke-width="8" fill="none"/><path d="M50,20 V 80 M20,50 H 80" stroke="#2ecc71" stroke-width="8"/><path d="M35,35 L 65,65 M65,35 L 35,65" stroke="#2ecc71" stroke-width="8" fill="none"/></svg>`,
                    datos_interes: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M50,10 A35,35 0 1,1 50,80 A10,10 0 0,1 50,60 A15,15 0 0,0 50,30 A35,35 0 0,1 50,10" fill="#f1c40f"/><circle cx="50" cy="90" r="5" fill="#f1c40f"/></svg>`,
                    ejemplos: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M50 10 C 60 40, 60 60, 50 90 C 40 60, 40 40, 50 10" fill="#e74c3c"/><circle cx="50" cy="50" r="8" fill="white"/></svg>`
                },
                montacargas: {
                     conceptos: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect x="15" y="65" width="70" height="20" rx="5" fill="#3498db"/><rect x="25" y="40" width="10" height="25" fill="#3498db"/><rect x="65" y="40" width="10" height="25" fill="#3498db"/><circle cx="25" cy="85" r="10" fill="#2c3e50"/><circle cx="75" cy="85" r="10" fill="#2c3e50"/><rect x="40" y="20" width="20" height="20" fill="#f1c40f" rx="3"/></svg>`,
                    caracteristicas: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect x="20" y="20" width="60" height="60" rx="10" fill="#f1c40f"/><path d="M50 20 V 80 M20 50 H 80" stroke="white" stroke-width="8" stroke-linecap="round"/></svg>`,
                    beneficios: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M50 10 L90 35 L90 85 L50 110 L10 85 L10 35 Z" fill="rgba(255,255,255,0.8)"/><path d="M50 30 L50 80 M30 55 H 70" stroke="#4a90e2" stroke-width="5" stroke-linecap="round"/></svg>`,
                    prevencion: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M50,10 A40,40 0 1,1 50,90 A40,40 0 1,1 50,10" fill="#2ecc71" opacity="0.8"/><rect x="45" y="30" width="10" height="40" fill="white" rx="2"/><path d="M50 30 L50 70 L60 75 L40 75 L50 70 Z" fill="white"/></svg>`,
                    datos_interes: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><rect x="20" y="70" width="15" height="20" fill="#f39c12"/><rect x="42" y="50" width="15" height="40" fill="#e67e22"/><rect x="64" y="30" width="15" height="60" fill="#d35400"/></svg>`,
                    ejemplos: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M50 10 L90 50 L50 90 L10 50 Z" fill="#e74c3c"/><path d="M35 60 L65 60 L65 40 L35 40 Z" fill="white"/><text x="50" y="55" font-size="20" text-anchor="middle" fill="#e74c3c" font-weight="bold">!</text></svg>`
                },
                generic: {
                    conceptos: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M50 10 L95 90 L5 90 Z" fill="#3498db" fill-opacity="0.8"/><text x="50" y="65" font-size="40" text-anchor="middle" fill="white" font-weight="bold">i</text></svg>`,
                    caracteristicas: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M50,10 A35,35 0 1,1 50,80 A10,10 0 0,1 50,60 A15,15 0 0,0 50,30 A35,35 0 0,1 50,10" fill="#9b59b6"/><circle cx="50" cy="90" r="5" fill="#9b59b6"/></svg>`,
                    beneficios: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><g filter="url(#glow)"><path d="M50 10 L90 35 L90 85 L50 110 L10 85 L10 35 Z" fill="rgba(255,255,255,0.8)"/><path d="M50 10 L10 35 L50 60 L90 35 Z" fill="rgba(255,255,255,0.6)"/><path d="M10 35 L10 85 L50 110 L50 60 Z" fill="rgba(255,255,255,0.4)"/><path d="M90 85 L90 35 L50 60 L50 110 Z" fill="rgba(255,255,255,0.9)"/></g><defs><filter id="glow"><feGaussianBlur stdDeviation="2.5" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs></svg>`,
                    prevencion: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M10 50 L40 80 L90 30" stroke="#2ecc71" stroke-width="12" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>`,
                    datos_interes: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M50 10 L95 90 L5 90 Z" fill="#f1c40f" fill-opacity="0.8"/><text x="50" y="65" font-size="40" text-anchor="middle" fill="white" font-weight="bold">#</text></svg>`,
                    ejemplos: `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="40" fill="#e74c3c"/><path d="M50 30 L50 55 M50 65 L50 70" stroke="white" stroke-width="10" stroke-linecap="round"/></svg>`
                }
            };
            
            // Usar iconos gen√©ricos para temas no espec√≠ficos
            if (!svgs[topicKey]) {
                return svgs.generic;
            }
            return svgs[topicKey];
        }

        function populateAdvancedBrochure(content, topic) {
            // Panel de Cubierta
            document.getElementById('mainTitle').textContent = content.title;
            document.getElementById('mainSubtitle').textContent = content.subtitle;
            
            const sections = ['conceptos', 'caracteristicas', 'beneficios', 'prevencion', 'datos_interes', 'ejemplos'];
            
            // Mapeo del ID de HTML (en ingl√©s) a la clave de contenido (en espa√±ol)
            const sectionMap = {
                'conceptos': 'concept', 
                'caracteristicas': 'characteristics', 
                'beneficios': 'benefits', 
                'prevencion': 'prevention', 
                'datos_interes': 'data', 
                'ejemplos': 'examples'
            };

            sections.forEach(secKey => {
                const htmlKey = sectionMap[secKey];
                const sectionData = content[secKey];

                if (sectionData) {
                    // Cargar la descripci√≥n y la lista
                    document.getElementById(`${htmlKey}Description`).textContent = sectionData.description;
                    const listEl = document.getElementById(`${htmlKey}List`);
                    if (listEl) {
                        listEl.innerHTML = sectionData.list.slice(0, 4).map(item => `<li>${item}</li>`).join('');
                    }
                }
            });

            // Populate SVGs
            const images = getTopicSpecificSVGs(topic);
            document.getElementById('coverImage').innerHTML = images.beneficios;
            document.getElementById('conceptImage').innerHTML = images.conceptos;
            document.getElementById('characteristicsImage').innerHTML = images.caracteristicas;
            document.getElementById('preventionImage').innerHTML = images.prevencion;
            document.getElementById('dataImage').innerHTML = images.datos_interes;
            document.getElementById('examplesImage').innerHTML = images.ejemplos;
        }
        
        // Funci√≥n para descargar como PDF (utiliza la impresi√≥n nativa)
        function downloadAsPDF() {
            window.print();
            showNotification('Abre el di√°logo de impresi√≥n y selecciona "Guardar como PDF" como destino.', 'info');
        }


        function downloadAsWord() {
            const contentElement = document.querySelector('.brochure-content-wrapper');
            const contactElement = document.querySelector('.contact-info-footer');

            if (!contentElement) {
                showNotification('Primero genera un folleto para poder descargarlo.', 'warning');
                return;
            }
            const title = document.getElementById('mainTitle').textContent || 'Folleto de Seguridad';
            
            // Clonar el contenido para no modificar el original
            const contentClone = contentElement.cloneNode(true);
            const contactClone = contactElement.cloneNode(true);
            
            // Forzar estilos en el clon para la exportaci√≥n
            contentClone.style.display = 'block';
            contentClone.style.color = '#000'; 
            
            // Simplificar los paneles para una estructura de Word m√°s limpia
            const panels = contentClone.querySelectorAll('.panel');
            panels.forEach(panel => {
                panel.style.border = '1px solid #ccc';
                panel.style.padding = '15px';
                panel.style.backgroundColor = '#f7f7f7';
                panel.style.color = '#000';
            });
            const cover = contentClone.querySelector('.benefits-panel');
            if(cover) {
                 cover.style.backgroundColor = '#e0e0e0';
                 cover.style.color = '#000';
            }

            // Eliminar SVGs que no se exportan bien a Word
            contentClone.querySelectorAll('.panel-image').forEach(img => img.remove());
            
            const htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>${title}</title>
                    <style>
                        body { font-family: Arial, sans-serif; font-size: 11pt; }
                        .brochure-front, .brochure-back { display: block; width: 100%; border-collapse: collapse; page-break-after: always; margin-bottom: 20px;}
                        .panel { 
                            display: block; 
                            width: 90%; 
                            vertical-align: top; 
                            padding: 15px; 
                            margin: 10px auto;
                            box-sizing: border-box;
                            border: 1px solid #ccc;
                            background-color: #f7f7f7;
                        }
                        .panel-title { font-size: 14pt; font-weight: bold; color: #1e3a8a;}
                        .cover-title { font-size: 18pt; color: #1e3a8a; }
                        .cover-subtitle { font-size: 12pt; color: #3498db; }
                        .panel-list { list-style: disc; padding-left: 30px; }
                        .panel-list li { margin-bottom: 8px; font-size: 10pt; }
                        .panel-list li::before { content: none; }
                        .contact-info-footer { padding: 20px; text-align: center; border-top: 2px solid #ccc;}
                        .emergency-numbers { border: 1px solid #e74c3c; padding: 10px; display: inline-block; margin-left: 10px; }
                    </style>
                </head>
                <body>
                    <h1 style="text-align: center; color: #1e3a8a;">${title}</h1>
                    <h2 style="text-align: center; color: #3498db;">Contenido del Folleto</h2>
                    
                    <h3 style="color: #4a90e2;">P√°gina 1 (Conceptos, Caracter√≠sticas, Beneficios)</h3>
                    <div>${contentClone.querySelector('.brochure-front').innerHTML}</div>

                    <h3 style="color: #4a90e2; page-break-before: always;">P√°gina 2 (Prevenci√≥n, Datos de Inter√©s, Ejemplos)</h3>
                    <div>${contentClone.querySelector('.brochure-back').innerHTML}</div>

                    ${contactClone.outerHTML}
                </body>
                </html>`;
            
            var converted = htmlDocx.asBlob(htmlContent);
            saveAs(converted, `${title.replace(/ /g, '_')}.docx`);
            showNotification('Descargando documento de Word...', 'success');
        }

        function generateNew() {
            document.getElementById('brochureResult').style.display = 'none';
            document.getElementById('topic').value = '';
            document.getElementById('topic').focus();
            document.querySelector('.generator-section').scrollIntoView({ behavior: 'smooth' });
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            const style = document.createElement('style');
            style.textContent = `
                .notification {
                    position: fixed; top: 20px; right: 20px;
                    padding: 15px 25px; border-radius: 8px; color: white;
                    font-weight: 600; z-index: 1000;
                    animation: slideIn 0.3s ease, slideOut 0.3s ease 2.7s forwards;
                    font-family: var(--font-body);
                }
                .notification-success { background: linear-gradient(135deg, #27ae60, #2ecc71); }
                .notification-warning { background: linear-gradient(135deg, #f39c12, #e67e22); }
                .notification-error { background: linear-gradient(135deg, #e74c3c, #c0392b); }
                .notification-info { background: linear-gradient(135deg, #3498db, #2980b9); }
                @keyframes slideIn { from { transform: translateX(110%); } to { transform: translateX(0); } }
                @keyframes slideOut { from { transform: translateX(0); } to { transform: translateX(110%); } }
            `;
            document.head.appendChild(style);
            
            setTimeout(() => {
                notification.remove();
                style.remove();
            }, 3000);
        }

        // Inicializar vista previa de la paleta y aplicar el estilo por defecto
        document.addEventListener('DOMContentLoaded', () => {
            updatePalettePreview('modern');
            const templateName = document.getElementById('template').value;
             if (templateName !== 'modern') {
                 brochureResult.classList.add(`template-${templateName}`);
                 document.body.classList.add(`template-${templateName}`);
            }
        });
    </script>
</body>
</html>
